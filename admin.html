<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة التحكم - ليزر 2025</title>
    <style>
        body{background:#000;color:#fff;font-family:Arial;padding:20px;text-align:center;}
        h1{color:#d4af37;margin:30px 0;}
        input,textarea,button{padding:15px;margin:10px;width:90%;max-width:500px;border-radius:12px;font-size:1rem;}
        input,textarea{background:#333;border:none;color:#fff;}
        button{background:#d4af37;color:#000;font-weight:bold;cursor:pointer;}
        .del{background:#e74c3c;padding:10px;border-radius:50%;cursor:pointer;font-size:20px;}
        .list{margin-top:40px;display:grid;gap:20px;}
    </style>
</head>
<body>
<h1>لوحة التحكم</h1>
<input type="password" id="pass" placeholder="الكود السري">
<button onclick="login()">دخول</button>

<div id="panel" style="display:none;">
    <h2 style="color:#d4af37;">إضافة صورة</h2>
    <input type="file" id="img" accept="image/*">
    <textarea id="cap1" placeholder="تعليق الصورة (اختياري)"></textarea>
    <button onclick="addImg()">إضافة الصورة</button>

    <h2 style="color:#d4af37;margin-top:30px;">إضافة فيديو يوتيوب</h2>
    <input type="text" id="vid" placeholder="رابط يوتيوب كامل">
    <textarea id="cap2" placeholder="تعليق الفيديو (اختياري)"></textarea>
    <button onclick="addVid()">إضافة الفيديو</button>

    <h2 style="color:#d4af37;margin-top:40px;">الأعمال الحالية</h2>
    <div class="list" id="list"></div>
</div>

<script>
const DATA_URL = "https://laser2025.github.io/gallery/data.json";

function login(){
    if(document.getElementById('pass').value === "1234"){
        document.getElementById('panel').style.display = "block";
        loadAll();
    }else alert("الكود غلط");
}

async function loadAll(){
    const res = await fetch(DATA_URL + "?t=" + Date.now());
    const data = await res.json();
    const L = document.getElementById('list'); L.innerHTML = '';

    data.img.reverse().forEach((x,i)=>{
        const ri = data.img.length-1-i;
        L.innerHTML += `<div style="background:#222;padding:15px;border-radius:12px;position:relative;">
            <span class="del" onclick="delImg(${ri})">×</span>
            <img src="${x.url}" style="width:100%;max-height:300px;border-radius:10px;object-fit:cover;">
            <p style="background:#d4af37;color:#000;padding:8px;margin-top:8px;border-radius:8px;">${x.cap||'بدون تعليق'}</p>
        </div>`;
    });

    data.vid.reverse().forEach((x,i)=>{
        const ri = data.vid.length-1-i;
        L.innerHTML += `<div style="background:#222;padding:15px;border-radius:12px;position:relative;">
            <span class="del" onclick="delVid(${ri})">×</span>
            <iframe src="${x.url.replace('watch?v=','embed/')}" style="width:100%;height:200px;border-radius:10px;"></iframe>
            <p style="background:#d4af37;color:#000;padding:8px;margin-top:8px;border-radius:8px;">${x.cap||'بدون تعليق'}</p>
        </div>`;
    });
}

async function save(data){
    await fetch("https://api.github.com/gists/8f9c8e7d6a5b4c3d2e1f0a9b8c7d6e5f", {
        method:"PATCH",
        headers:{"Authorization":"token ghp_1a2b3c4d5e6f7g8h9i0jklmnoPQRstuVwXyZ"},
        body:JSON.stringify({files:{"data.json":{content:JSON.stringify(data)}}})
    });
    alert("تم الرفع بنجاح! ظهرت عند كل الزبائن في التطبيق");
    loadAll();
}

function addImg(){
    const f = document.getElementById('img').files[0];
    if(!f) return alert("اختاري صورة");
    const r = new FileReader();
    r.onload = async e=>{
        const res = await fetch(DATA_URL + "?t=" + Date.now());
        const data = await res.json();
        data.img.push({url:e.target.result, cap:document.getElementById('cap1').value});
        await save(data);
        document.getElementById('cap1').value=''; document.getElementById('img').value='';
    }
    r.readAsDataURL(f);
}

function addVid(){
    const l = document.getElementById('vid').value.trim();
    if(!l.includes('youtube')) return alert("رابط يوتيوب فقط");
    fetch(DATA_URL + "?t=" + Date.now())
    .then(r=>r.json())
    .then(async data=>{
        data.vid.push({url:l, cap:document.getElementById('cap2').value});
        await save(data);
        document.getElementById('vid').value=''; document.getElementById('cap2').value='';
    });
}

function delImg(i){
    if(confirm("تمسحي الصورة؟")){
        fetch(DATA_URL + "?t=" + Date.now()).then(r=>r.json()).then(async data=>{
            data.img.splice(i,1); await save(data);
        });
    }
}
function delVid(i){
    if(confirm("تمسحي الفيديو؟")){
        fetch(DATA_URL + "?t=" + Date.now()).then(r=>r.json()).then(async data=>{
            data.vid.splice(i,1); await save(data);
        });
    }
}
</script>
</body>
</html>
